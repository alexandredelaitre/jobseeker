<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello Bulma!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>
<body>
<script>
    // // const login = window.open('https://identity.deso.org/log-in');
    // login;

    function Queue() {
        this.elements = [];

        Queue.prototype.enqueue = function (e) {
            this.elements.push(e);
        };

        // remove an element from the front of the queue
        Queue.prototype.dequeue = function () {
            return this.elements.shift();
        };


        // check if the queue is empty
        Queue.prototype.isEmpty = function () {
            return this.elements.length == 0;
        }


        // get the element at the front of the queue
        Queue.prototype.peek = function () {
            return !this.isEmpty() ? this.elements[0] : undefined;
        };

        Queue.prototype.length = function () {
            return this.elements.length;
        }
    }


    function uuid() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    function showFrame() {
        document.getElementById("identity.style.display = 'block'");
    }

    let q = new Queue();
    const login = window.open('https://identity.deso.org/log-in?accessLevelRequest=4', null);


    function send(method, payload) {
        let id = uuid();
        const req = {
            id,
            method,
            payload,
            service: "identity",
        };

        q.enqueue(req);

        console.log(this.postMessage(req));
    }

    window.addEventListener("message", (event) => {
        if (event.origin !== 'https://identity.deso.org') {
            return;
        }

        // if (q.peek().method === "info" && event.data.method === "")

        console.log(q.peek().method);
        console.log(event.data.method);

        console.log(event);
    })

    send('info');
</script>
<iframe
        id="identity"
        frameborder="0"
        src="https://identity.deso.org/embed"
        style="height: 100vh; width: 100vw; display: none; position: fixed;
    z-index: 1000; left: 0; top: 0;"
></iframe>
<section class="hero is-link">
    <div class="hero-body">
        <p class="title">
            QuestMaster
        </p>
        <p class="subtitle">
            Do task get $DESO.
        </p>
    </div>
</section>
<section class="section">
    <div class="box">
        <div class="content">
            <p><strong>Testing task name</strong> <small>@rainestormee</small> <small>1m</small></p>
            <br>
            <p>This is a testing task description click on this to get more info.</p>
        </div>
        <button class="button">Get More Info</button>
        <button class="button is-success is-light">Complete Quest</button>
    </div>
    <div class="box">
        <div class="content">
            <p><strong>Adding program.</strong> <small>@rainestormee</small> <small>1hr</small></p>
            <br>
            <p>I need a program that adds two things together please.</p>
        </div>
        <button class="button">Get More Info</button>
        <button class="button is-success" disabled>COMPLETED</button>
    </div>
</section>
</body>
</html>
